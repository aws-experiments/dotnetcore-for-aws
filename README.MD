## Links
Download sdk from [link](https://dotnet.microsoft.com/download/thank-you/dotnet-sdk-2.2.107-windows-x64-installer)

## Secrets
No secrets are in git,

Open main solution in vs 2017

Right click Dotnetcore.For.Aws.Service - then 
Select 'Manage User Secrets'

type the following in the autogenerated secrets.json

```

{
	"Config":{
		"Auth": {
		  "BaseUrl": "{{PLACEHOLDER}}",
		  "Authority": "{{PLACEHOLDER}}",
		  "CognitoClientId": "{{PLACEHOLDER}}",
		  "AppName": "{{PLACEHOLDER}}"
		}
	}
}
```

of course {{PLACEHOLDER}}s must be replaced appropriately.

## docker commands
```
 sudo docker build -t dotnetcoreforaws .
  sudo docker run --name dotnetcoreforaws_run --rm -d -it -p 8080:50366 dotnetcoreforaws
  sudo docker images ls
 curl localhost:8080/api/values

```

## Commands run
```
\projects>dotnet --version
2.2.107

\projects\dotnetcore-for-aws\src>dotnet new webapi -n Dotnetcore.For.Aws.Service


Telemetry
---------
The .NET Core tools collect usage data in order to help us improve your experience. The data is anonymous and doesn't include command-line arguments. The data is collected by Microsoft and shared with the community. You can opt-out of telemetry by setting the DOTNET_CLI_TELEMETRY_OPTOUT environment variable to '1' or 'true' using your favorite shell.

Read more about .NET Core CLI Tools telemetry: https://aka.ms/dotnet-cli-telemetry

ASP.NET Core
------------
Successfully installed the ASP.NET Core HTTPS Development Certificate.
To trust the certificate run 'dotnet dev-certs https --trust' (Windows and macOS only). For establishing trust on other platforms refer to the platform specific documentation.
For more information on configuring HTTPS see https://go.microsoft.com/fwlink/?linkid=848054.
Getting ready...
The template "ASP.NET Core Web API" was created successfully.

Processing post-creation actions...
Running 'dotnet restore' on Dotnetcore.For.Aws.Service\Dotnetcore.For.Aws.Service.csproj...
  Restore completed in 22.48 sec for \projects\dotnetcore-for-aws\Dotnetcore.For.Aws.Service.csproj.

Restore succeeded.


\projects>cd dotnetcore-for-aws

\projects\dotnetcore-for-aws>cd src


\projects\dotnetcore-for-aws\src>dotnet new classlib -n Dotnetcore.For.Aws.Domain
The template "Class library" was created successfully.

\projects\dotnetcore-for-aws\src>cd ..

\projects\dotnetcore-for-aws>cd tests

\projects\dotnetcore-for-aws\tests>dotnet new xunit -n Dotnetcore.For.Aws.Service.Tests
The template "xUnit Test Project" was created successfully.
```

## Setup identity


Open Cognito
![image](https://user-images.githubusercontent.com/2136211/60689627-062bb700-9edd-11e9-96d9-87f64f6d539e.png)

Click manage user pool
![image](https://user-images.githubusercontent.com/2136211/60689634-23608580-9edd-11e9-9a86-ca5edafdf3de.png)

Type name - accept defaults- create pool button
![image](https://user-images.githubusercontent.com/2136211/60689650-4e4ad980-9edd-11e9-8ab2-1d71d9509f93.png)

We need to register our Web API application (dotnetcore-for-aws)

Select app client

![image](https://user-images.githubusercontent.com/2136211/60689690-c9ac8b00-9edd-11e9-845b-bd3b8cc8fb12.png)

Check only “Enable sign-in API for server-based authentication”.
![image](https://user-images.githubusercontent.com/2136211/60690007-63296c00-9ee1-11e9-888e-af1ecb9f8b8c.png)

Click “Create app client”

 “App client id” will be generated- note it down

![image](https://user-images.githubusercontent.com/2136211/60690063-e6e35880-9ee1-11e9-8ac9-74d2d01d5eb3.png)

Go to general settings

![image](https://user-images.githubusercontent.com/2136211/60690160-b7811b80-9ee2-11e9-83c6-f688f8514f4f.png)

Above will help me to make 
https://cognito-idp.us-east-2.amazonaws.com/us-east-2_xxxxxx

Then continue to follow steps of [this cognito blog](http://snevsky.com/blog/dotnet-core-authentication-aws-cognito)


Then allow implicit auth

![image](https://user-images.githubusercontent.com/2136211/60698353-8d445380-9f0c-11e9-9676-d951ff14ad7a.png)

Set domain

![image](https://user-images.githubusercontent.com/2136211/60698601-c4673480-9f0d-11e9-9606-6c59111dcf9d.png)



Add resource 

![image](https://user-images.githubusercontent.com/2136211/60735789-3b361900-9f72-11e9-873b-9bf537472ce6.png)
 as explained in https://medium.com/@robert.broeckelmann/openid-connect-authorization-code-flow-with-aws-cognito-246997abd11a


Revisit app settings

![image](https://user-images.githubusercontent.com/2136211/60736010-2ad26e00-9f73-11e9-8952-e279dce9ef5c.png)

